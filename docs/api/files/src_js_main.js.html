<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\main.js - FA2RE - SE</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="FA2RE - SE" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.8</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Converter.html">Converter</a></li>
                                <li><a href="../classes/CustomErrorListener.html">CustomErrorListener</a></li>
                                <li><a href="../classes/DSLLoader.html">DSLLoader</a></li>
                                <li><a href="../classes/EO_AST.html">EO_AST</a></li>
                                <li><a href="../classes/EO_AST_Node.html">EO_AST_Node</a></li>
                                <li><a href="../classes/EO_AST_NodeAuto.html">EO_AST_NodeAuto</a></li>
                                <li><a href="../classes/EO_AST_NodeE.html">EO_AST_NodeE</a></li>
                                <li><a href="../classes/EO_AST_NodeE1.html">EO_AST_NodeE1</a></li>
                                <li><a href="../classes/EO_AST_NodeF.html">EO_AST_NodeF</a></li>
                                <li><a href="../classes/EO_AST_NodeLoop.html">EO_AST_NodeLoop</a></li>
                                <li><a href="../classes/EO_AST_NodeManual.html">EO_AST_NodeManual</a></li>
                                <li><a href="../classes/EO_AST_NodeReserved.html">EO_AST_NodeReserved</a></li>
                                <li><a href="../classes/EO_AST_NodeT.html">EO_AST_NodeT</a></li>
                                <li><a href="../classes/EO_AST_NodeT1.html">EO_AST_NodeT1</a></li>
                                <li><a href="../classes/EO_AST_NodeTerminal.html">EO_AST_NodeTerminal</a></li>
                                <li><a href="../classes/EO_AST_NodeV.html">EO_AST_NodeV</a></li>
                                <li><a href="../classes/EvalResult.html">EvalResult</a></li>
                                <li><a href="../classes/FALoader.html">FALoader</a></li>
                                <li><a href="../classes/Stack.html">Stack</a></li>
                                <li><a href="../classes/VarMap.html">VarMap</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/FAutils.html">FAutils</a></li>
                                <li><a href="../modules/FiniteAutomata.html">FiniteAutomata</a></li>
                                <li><a href="../modules/Grammar.html">Grammar</a></li>
                                <li><a href="../modules/Main.html">Main</a></li>
                                <li><a href="../modules/Utils.html">Utils</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\js\main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
$( document ).ready(function() {
	require(&#x27;dsl/EliminationOrderLexer&#x27;);
	require(&#x27;dsl/EliminationOrderParser&#x27;);
	require(&#x27;dsl/CustomListener&#x27;);
	require(&#x27;dsl/ast/VarMap&#x27;);
	require(&#x27;dsl/ast/EO_AST&#x27;);
	require(&#x27;dsl/ast/EO_AST_Node&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeManual&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeAuto&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeE&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeE1&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeV&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeLoop&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeF&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeT&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeT1&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeTerminal&#x27;);
	require(&#x27;dsl/ast/EO_AST_NodeReserved&#x27;);
	require(&#x27;dsl/ast/EvalResult&#x27;);
	require(&#x27;dsl/CustomErrorListener&#x27;);
	require(&#x27;js/Stack&#x27;);

	document.getElementById(&quot;dottextareadiv&quot;).style.visibility=&#x27;hidden&#x27;;
});

/**
 * This module initializes the page and performs the on-page actions,
 * then calling the rest of the API to perform the intended actions.
 * Please consult the documentation of the methods in this file for more details
 * 
 * @module Main
 */

var fa = null;
var ast = null;
var stepsNumber;
var currStep = 0;
var steps;
var regex;
/*
 * This global variable is used by the API to place errors. It makes them easier to reach and track.
 */
var errors;

/*
 * Initializes the page, setting the click listeners for the buttons,
 * and the listeners for changes in the DSL input text
 */
var initPage = function() {
	
	dslInput = $(&#x27;#dsl_text&#x27;).html();
	$(&quot;#next&quot;).click(function(e) {
		if(currStep &lt; steps.length - 1) {
			currStep++;
			displayStep(steps, currStep);
		}
		return false;
	});

	$(&quot;#previous&quot;).click(function(e) {
		if(currStep &gt; 0) {
			currStep--;
			displayStep(steps, currStep);
		}
		return false;
	});

	$(&#x27;#dsl_text&#x27;).focus(function (evt) {
		if (typeof dslInput === &#x27;undefined&#x27;) {
			dslInput = $(this).html();
			return;
		}
		$(this).html(dslInput);
	});

	$(&#x27;#dsl_text&#x27;).change(function (evt) {
		dslInput = $(this).html();
	});
	$(&#x27;#dsl_text&#x27;).on(&#x27;input&#x27;, (function (evt) {
		dslInput = $(this).html();
	}));

	$(&#x27;#dslButton&#x27;).click(function (evt) {
		$(&quot;.errors&quot;).empty();
		$(&quot;#success&quot;).hide();
		$(&#x27;#dsl_text&#x27;).html(dslInput);
		parseDSL(evt);
	});

	$(&quot;#results_available&quot;).css(&quot;display&quot;, &quot;none&quot;);
}

/*
 * Open the automata&#x27;s dot file, performing required validations
 */
var openAutomata = function (event) {
	$(&quot;#results_available&quot;).css(&quot;display&quot;, &quot;none&quot;);
	$(&quot;#results_unavailable&quot;).css(&quot;display&quot;, &quot;block&quot;);
	$(&quot;#error_dot&quot;).css(&quot;display&quot;, &quot;block&quot;);

	fa = null;

	var input = event.target;

	var reader = new FileReader();
	// Action performed when the automata loads
	reader.onload = function(){
		loadAutomataFromText(reader.result);
		document.getElementById(&quot;dottextareadiv&quot;).style.visibility=&#x27;visible&#x27;;
		document.getElementById(&quot;dottextareadiv&quot;).value = reader.result;
	};
	reader.readAsText(input.files[0]);
};

/*
 * Actually parses the text containing a doc-style automata, validates and displays it.
 */
var loadAutomataFromText = function (text) {
	// Use FALoader to load the automata
	var faLoader = new FALoader(text);
	fa = faLoader.load();
	tryStartingConverter();

	var options = {
			nodes:{
				color: &#x27;grey&#x27;,
				shadow: true
			}
	}
	// create a network to visualize in the page with &quot;vis&quot;
	var container = document.getElementById(&#x27;mynetwork&#x27;);
	var network = new vis.Network(container, fa, options);

	$(&quot;#error_dot&quot;).css(&quot;display&quot;, &quot;none&quot;);
	if(ast !== null) {
		$(&quot;#error_dsl&quot;).css(&quot;display&quot;, &quot;none&quot;);
		$(&quot;#results_available&quot;).css(&quot;display&quot;, &quot;block&quot;);
		$(&quot;#results_unavailable&quot;).css(&quot;display&quot;, &quot;none&quot;);
	}
}

/*
 * Loads one of the sample automatas. Currently, only numbers 1-5 are supported
 */
var loadSampleAutomata = function (number) {
	if(number &lt; 1 || number &gt; 5)
		return;
	
	$.get(&#x27;res/samples/fa&#x27; + number + &#x27;.dot&#x27;, function(result) {
		loadAutomataFromText(result);
		document.getElementById(&quot;dottextareadiv&quot;).style.visibility=&#x27;visible&#x27;;
		document.getElementById(&quot;dottextareadiv&quot;).value = result;
	});
}

/*
 * Read and validate the DSL expression
 */
var parseDSL = function(event) {
	$(&quot;#results_available&quot;).css(&quot;display&quot;, &quot;none&quot;);
	$(&quot;#results_unavailable&quot;).css(&quot;display&quot;, &quot;block&quot;);
	$(&quot;#error_dsl&quot;).css(&quot;display&quot;, &quot;block&quot;);
	ast = null;

	errors = [];
	console.log(&quot;PARSING &quot; + $(&#x27;&lt;div/&gt;&#x27;).html(dslInput).text());
	var dslLoader = new DSLLoader($(&#x27;&lt;div/&gt;&#x27;).html(dslInput).text());
	
	// Load the DSL expression using DSLLoader, returning the ast
	ast = dslLoader.load();
	// If parsing the DSL expression resulted in errors, they will be in the &quot;errors&quot; array
	if (errors.length &gt; 0) ast = null;
	if(ast == null) {
		console.error(&quot;No ast returned.&quot;);

		// Display errors in a user friendly way
		displayErrors();
		errors = [];

		return;
	} else {
		$(&quot;#success&quot;).show(&quot;fast&quot;);
		$(&quot;#success&quot;).css(&#x27;display&#x27;, &#x27;inline-block&#x27;);
	}
	errors = [];
	tryStartingConverter();
	displayErrors();

	if(errors.length == 0 &amp;&amp; ast != null) {
		$(&quot;#error_dsl&quot;).css(&quot;display&quot;, &quot;none&quot;);
		if(fa != null) {
			$(&quot;#error_dot&quot;).css(&quot;display&quot;, &quot;none&quot;);
			$(&quot;#results_available&quot;).css(&quot;display&quot;, &quot;block&quot;);
			$(&quot;#results_unavailable&quot;).css(&quot;display&quot;, &quot;none&quot;);
		}
	}

	errors = [];
}

/*
 * Display errors found in the DSL in a user-friendly and understandable way
 */
var displayErrors = function() {
	var compensationOffset = 0;
	for (var i = 0; i &lt; errors.length; i++) {
		var error = errors[i];

		// Display inline error for the first one only
		if (i == 0) {
			oldVal = dslInput;
			var newVal = oldVal.substr(0, error.offendingSymbol.start + compensationOffset);
			var erroredText = oldVal.substr(error.offendingSymbol.start + compensationOffset, error.offendingSymbol.stop+1 - error.offendingSymbol.start);
			newVal += &#x27;&lt;span class=&quot;text-error&quot;&gt;&#x27; + erroredText + &#x27;&lt;/span&gt;&#x27;;
			newVal += oldVal.substring(error.offendingSymbol.stop+1 + compensationOffset);
			compensationOffset += newVal.length - erroredText.length;
			console.log(error.recognizer, error.offendingSymbol, error.line, error.column, error.msg, error.e);
			$(&quot;#dsl_text&quot;).html(newVal);
		}

		var newEl;
		if (typeof error.line !== &#x27;undefined&#x27; &amp;&amp; typeof error.column !== &#x27;undefined&#x27;)
			newEl = $(&#x27;&lt;div class=&quot;error&quot; style=&quot;display: none;&quot;&gt;Ln. &#x27; + error.line + &#x27; Col. &#x27; + error.column + &#x27;: &#x27; + error.msg + &#x27;&lt;/div&gt;&#x27;);
		else
			newEl = $(&#x27;&lt;div class=&quot;error&quot; style=&quot;display: none;&quot;&gt;&#x27; + error.msg + &#x27;&lt;/div&gt;&#x27;);
		$(&quot;.errors&quot;).append(newEl);
		newEl.show(&quot;normal&quot;);
	}
}

/*
 * Tries to start the FA to RE converter. This is only done if there is a parsed AST and an automata, and if there are no errors.
 * If both conditions check, then everything is ready to start the conversion
 */
var tryStartingConverter = function() {
	if (!fa || !ast) return;
	var converter = new Converter(fa, ast);
	// The converter returns all the steps of the conversion, so that we can understand how states were eliminated from the automata
	var result = converter.convert();
	steps = result.steps;
	regex = result.regex;
	console.log(regex);
	
	showNodesRemoved();

	currStep = 0;

	$(&quot;#resultsre&quot;).text(&quot;Regex: &quot; + regex);
	$(&quot;#resultsNumSymbols&quot;).text(&quot;Number of Symbols: &quot; + calculateWeight(regex, Metrics.numSymbols));
	$(&quot;#resultsLength&quot;).text(&quot;Length: &quot; + calculateWeight(regex, Metrics.length));
	displayStep(steps, currStep);
}

/*
 * Display a specific step of the elimination steps of removing states from the automata
 */
function displayStep(steps, currStep) {
	var options = {
			nodes:{
				color: &#x27;grey&#x27;,
				shadow: true
			}
	};
	var container = document.getElementById(&#x27;mynetwork2&#x27;);
	var network = new vis.Network(container, steps[currStep].fa, options);
	$(&#x27;#steps&#x27;).text(currStep + &quot;/&quot; + (steps.length - 1));
	$(&#x27;#explanation&#x27;).text(steps[currStep].explanation);
}

var showNodesRemoved = function () {
	var removed_ids = [];
	
	for(var i = 0; i &lt; steps.length; ++i) {
		if(typeof steps[i].nodeRemoved != &#x27;undefined&#x27;) {
			removed_ids.push(steps[i].nodeRemoved);
		}
	}
	
	var text = &quot;Nodes removed in this order: &quot;;
	
	for(var i = 0; i &lt; removed_ids.length; ++i) {
		text += &quot;&#x27;&quot; + removed_ids[i] + &quot;&#x27; &quot;;
		if(i &lt; removed_ids.length - 1) {
			text += &quot; - &quot;;
		}
	}

	document.getElementById(&quot;nodedRemovedOrder&quot;).innerText = text;
}

/*
 * Switch to a state (section) of the page
 */
function toggleState(state) {
	document.getElementById(&#x27;about&#x27;).style.display = &#x27;none&#x27;;
	document.getElementById(&#x27;results&#x27;).style.display = &#x27;none&#x27;;
	document.getElementById(&#x27;dotFile&#x27;).style.display = &#x27;none&#x27;;
	document.getElementById(&#x27;parseDSL&#x27;).style.display = &#x27;none&#x27;;
	document.getElementById(&#x27;intro&#x27;).style.display = &#x27;none&#x27;;

	switch (state) {
	case 0:
		document.getElementById(&#x27;intro&#x27;).style.display = &#x27;block&#x27;;
		break;
	case 1:
		document.getElementById(&#x27;dotFile&#x27;).style.display = &#x27;block&#x27;;
		break;
	case 2:
		document.getElementById(&#x27;parseDSL&#x27;).style.display = &#x27;block&#x27;;
		break;
	case 3:
		document.getElementById(&#x27;results&#x27;).style.display = &#x27;block&#x27;;
		break;
	case 4:
		document.getElementById(&#x27;about&#x27;).style.display = &#x27;block&#x27;;
		break;
	}
}

$(document).ready(initPage);

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
